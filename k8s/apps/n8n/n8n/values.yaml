n8n:
  fullnameOverride: n8n

  ingress:
    enabled: false

  main:
    config:
      n8n:
        host: n8n.schober.dev
        port: 5678
        protocol: https
        editor_base_url: https://n8n.schober.dev
        public_api_url: https://n8n.schober.dev
        webhook_url: https://n8n.schober.dev
        secure_cookie: true
        diagnostics_enabled: false
      executions:
        mode: app
      db:
        type: postgresdb
        postgresdb:
          host: n8n-postgres-rw.n8n.svc.cluster.local
          port: 5432
          database: n8n
          user: n8n
    extraEnv:
      DB_POSTGRESDB_PASSWORD:
        valueFrom:
          secretKeyRef:
            name: n8n-postgres-app
            key: password
      QUEUE_BULL_REDIS_PASSWORD:
        valueFrom:
          secretKeyRef:
            name: n8n-secret
            key: REDIS_PASSWORD
      N8N_ENCRYPTION_KEY:
        valueFrom:
          secretKeyRef:
            name: n8n-secret
            key: ENCRYPTION_KEY
    persistence:
      enabled: true
      type: dynamic
      storageClass: proxmox-csi
      size: 10Gi

  valkey:
    enabled: false

postgres:
  enabled: true
  clusterName: n8n-postgres
  instances: 1
  storage:
    class: proxmox-csi
    size: 10Gi
  database: n8n
  owner: n8n

app:
  host: n8n.schober.dev
  gateway:
    name: internal-gateway
    namespace: istio-ingress-internal
    sectionName: https
  backendServiceName: n8n
  servicePort: 80
  authentik:
    enabled: true
    provider: authentik

externalSecret:
  enabled: true
  refreshInterval: 1h
  secretStoreRef:
    name: bitwarden
    kind: ClusterSecretStore
  keys:
    encryption: n8n-encryption-key
    redisPassword: valkey-password
