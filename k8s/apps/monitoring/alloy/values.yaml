alloy:
  configMap:
    # Basic Alloy configuration for homelab monitoring
    content: |
      // Prometheus remote write to local Prometheus
      prometheus.remote_write "default" {
        endpoint {
          url = "http://prometheus-server.monitoring.svc.cluster.local/api/v1/write"
        }
      }

      // Loki log forwarding
      loki.write "default" {
        endpoint {
          url = "http://loki-gateway.monitoring.svc.cluster.local/loki/api/v1/push"
        }
      }

      // Tempo traces forwarding
      otelcol.exporter.otlp "default" {
        client {
          endpoint = "tempo.monitoring.svc.cluster.local:4317"
          tls {
            insecure = true
          }
        }
      }

      // Kubernetes service discovery for scraping
      discovery.kubernetes "pods" {
        role = "pod"
      }

      // Scrape metrics from discovered pods
      prometheus.scrape "pods" {
        targets    = discovery.kubernetes.pods.targets
        forward_to = [prometheus.remote_write.default.receiver]
      }
